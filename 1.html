const template = {
    "interface_name": "wg0",
    "local_address": [],
    "mtu": 1280,
    "peer_public_key": "",
    "pre_shared_key": "",
    "private_key": "",
    "server": "",
    "server_port": 51820,
    "system_interface": false,
    "tag": "proxy",
    "type": "wireguard"
};

function generateConfig() {
    const wgConfig = document.getElementById('wg_config').value;
    const config = {};

    // Регулярные выражения для извлечения значений
    const regex = {
        Address: /Address\s*=\s*([^\s]+)/g,
        PrivateKey: /PrivateKey\s*=\s*([^\s]+)/g,
        PublicKey: /PublicKey\s*=\s*([^\s]+)/g,
        Endpoint: /Endpoint\s*=\s*([^\s]+)/g,
        PreSharedKey: /PreSharedKey\s*=\s*([^\s]+)/g,
    };


    for (const key in regex) {
        const match = wgConfig.match(regex[key]);
        if (match) {
            config[key] = match[1]; // Берем только первое найденное значение
        }
    }

    const filledTemplate = JSON.parse(JSON.stringify(template));
    filledTemplate.local_address = [config.Address];
    filledTemplate.private_key = config.PrivateKey;
    filledTemplate.peer_public_key = config.PublicKey;
    filledTemplate.pre_shared_key = config.PreSharedKey;

    if (config.Endpoint) {
        const [server, port] = config.Endpoint.split(':');
        filledTemplate.server = server;
        filledTemplate.server_port = parseInt(port);
    }


    const jsonOutput = JSON.stringify(filledTemplate, null, 2);
    document.getElementById('json_output').value = jsonOutput;
    document.getElementById('output-section').style.display = 'block';
}

new ClipboardJS('.btn');
